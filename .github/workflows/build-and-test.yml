name: build and test

on: [push]
  
jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
      with:
        token: ${{secrets.PERSONAL_ACCESS_TOKEN}}
        submodules: true
    - uses: docker://mmorse1217/hedgehog:latest
    - name: Build hedgehog
      run: |
        docker build -t hedgehog-dev --target=hedgehog-dev --cache-from="mmorse1217/hedgehog:latest" .
        ls
        pwd
        echo ${GITHUB_WORKSPACE}
        docker run --rm -v${GITHUB_WORKSPACE}:/hedgehog hedgehog-dev ls
        docker run --rm -v${GITHUB_WORKSPACE}:/hedgehog hedgehog-dev sh entrypoint.sh
